<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Layui</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../layuiv256/css/layui.css"  media="all">
    <!-- 注意：如果你直接复制所有代码到本地，上述css路径需要改成你本地的 -->

    <script src="../layuiv256/layui.js" charset="utf-8"></script>
    <!-- 注意：如果你直接复制所有代码到本地，上述js路径需要改成你本地的 -->
</head>
<body>
<blockquote class="layui-elem-quote">
    创建试卷
</blockquote>
<form class="layui-form" action="">

    <div class="layui-form-item">
        <label class="layui-form-label">年级/科目</label>
        <div class="layui-input-inline">
            <select name="subjectSelect" id="subjectSelect" lay-filter="subjectSelect" class="layui-select">

            </select>
        </div>
    </div>

    <div class="layui-form-item">
        <label class="layui-form-label">试卷标题</label>
        <div class="layui-input-block">
            <input type="text" name="title" required  lay-verify="required" placeholder="请输入" autocomplete="off" class="layui-input">
        </div>
    </div>



    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn" lay-submit lay-filter="formDemo">创建试卷</button>
            <button type="reset" class="layui-btn layui-btn-primary">重置</button>
        </div>
    </div>

</form>

<!--这里是右侧表格数据操作-->
<script type="text/html" id="barDemo">
    <a class="layui-btn layui-btn-xs" lay-event="edit">修改</a>
    <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="del">删除</a>
</script>

<div id="history">

</div>

<script>
    layui.use(['form','table','rate','jquery','layer','laytpl'], function(){
        let table=layui.table
        var form = layui.form,
            rate = layui.rate,
            $ = layui.jquery,
            layer = layui.layer,
            laytpl = layui.laytpl;

        $.get("../querySubject",function (e) {
            var subjectList = e.data;
            if(subjectList != null){
                var options = '<option value="">请选择科目</option>';
                for(var index in subjectList){
                    options+='<option value="'+subjectList[index].subjectId+'">'+subjectList[index].subjectName+'</option>';
                }
                $("#subjectSelect").html(options);
                form.render();
            }
        });

        //主动渲染
        table.render({
            elem: '#history'
            , url: '../createQuestionsController/getQuestionsLogs'
            , toolbar: '#toolbar' //开启头部工具栏，并为其绑定左侧模板
            , title: '模板表'
            , cols: [[
                {type: 'checkbox', fixed: 'left'}
                , {field: 'userName', title: '用户名', width: 440, fixed: 'left', unresize: true,}
                , {field: 'fileName', title: '用户文件', width: 90, edit: 'text'}
                , {field: 'gmtModified', title: '操作日期', width: 90, edit: 'text'}
                // , {field: 'joinTime', title: '创建时间', width: 120, edit: 'text', sort: true}
                // , {field: 'joinTime', title: '修改时间', width: 120, edit: 'text', sort: true}
                , {fixed: 'right', title: '操作', toolbar: '#barDemo', width: 150}
            ]]
            , page: true
        });

        //监听提交
        form.on('submit(formDemo)', function(data){
            $.post("../createQuestionsController/createQuestions",data.field ,function (e) {
                layer.msg(e.msg)
                if (e.code==200){
                    layer.open({
                        type:2,
                        content: 'http://view.xdocin.com/xdoc?_xdoc=http://www.enablue.com/ROOT1/download/'+e.newFileName+'.doc', //这里content是一个普通的String
                        area: ['800px', '800px'],
                        btn:['保存','下载','放弃'],
                        yes:function (index,layero) {
                            layer.msg("已将保存")
                        },
                        btn2:function (index,layero) {
                            layer.msg("下载")
                            window.open(encodeURI("../downLoadServlet?filename="+e.newFileName+".doc"));
                        },
                        btn3:function (index,layero) {
                            layer.msg("放弃")
                        }
                    });

                }

            })
            return false;
        });

    });
</script>

</body>
</html>
